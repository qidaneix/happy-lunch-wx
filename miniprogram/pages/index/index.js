"use strict";
var app = getApp();
Page({
    data: {
        list: [],
        errorList: [],
        count: 0,
    },
    timerId: null,
    pageShowTime: 0,
    startTime: 0,
    scanTime: 0,
    init: function () {
        var _this = this;
        wx.openBluetoothAdapter({
            mode: "central",
            success: function (res) {
                console.log("openBluetoothAdapter succ", res);
                _this.startTime = Date.now();
                wx.showToast({
                    title: "蓝牙启动成功",
                    icon: "success",
                    duration: 5000,
                });
                _this.startScan();
            },
            fail: function (res) {
                console.error("openBluetoothAdapter fail", res);
                _this.errTips();
                _this.startTime = Date.now();
            },
        });
    },
    startScan: function () {
        var _this = this;
        wx.startBluetoothDevicesDiscovery({
            allowDuplicatesKey: true,
            powerLevel: "high",
            success: function (e) {
                console.log("startBluetoothDevicesDiscovery succ", e);
                _this.scanTime = Date.now();
                wx.onBluetoothDeviceFound(function (res) {
                    res.devices.forEach(function (device) {
                        if (device.name.indexOf("weixiao") > -1) {
                            try {
                                var view = new Uint8Array(device.advertisData);
                                var arr = [];
                                for (var i = 0; i < view.length; i++) {
                                    arr.push(view[i].toString(16));
                                }
                                console.log("onBluetoothDeviceFound found!", device, device.name, arr);
                                if (_this.data.list.length)
                                    return;
                                var now = Date.now();
                                var openInterval = now - _this.pageShowTime;
                                var startInterval = now - _this.startTime;
                                var scanInterval = now - _this.scanTime;
                                _this.setData({
                                    list: [
                                        {
                                            name: device.localName,
                                            arr: arr.join("-").toUpperCase(),
                                            RSSI: device.RSSI + "dBm",
                                            openInterval: openInterval / 1000 + "s",
                                            startInterval: startInterval / 1000 + "s",
                                            scanInterval: scanInterval / 1000 + "s",
                                        },
                                    ],
                                });
                            }
                            catch (e) {
                                console.error("parse advertisData error", e);
                            }
                            wx.stopBluetoothDevicesDiscovery({
                                success: function (e) {
                                    console.log("stopBluetoothDevicesDiscovery succ", e);
                                },
                                fail: function (e) {
                                    console.error("stopBluetoothDevicesDiscovery fail", e);
                                },
                            });
                        }
                    });
                });
            },
            fail: function (e) {
                console.error("startBluetoothDevicesDiscovery fail", e);
                wx.getSystemInfo({
                    success: function (res) {
                        if (e.errCode === 10001 && e.errno === 1500102) {
                            wx.showModal({
                                content: "蓝牙搜索广播失败，请检查系统蓝牙功能是否开启。\n开启后请扫码重新进入页面！",
                                showCancel: false,
                            });
                        }
                        else if (res.platform === "android" &&
                            e.errCode === -1 &&
                            e.errno === 1509009) {
                            wx.showModal({
                                content: "蓝牙搜索广播失败，请检查系统定位功能是否开启。\n开启后请扫码重新进入页面！",
                                showCancel: false,
                            });
                        }
                        else if (res.platform === "android" &&
                            e.errCode === -1 &&
                            e.errno === 1509008) {
                            wx.showModal({
                                content: "蓝牙搜索广播失败，请检查是否为微信授权定位功能。\n开启后请扫码重新进入页面！",
                                showCancel: false,
                            });
                        }
                    },
                });
            },
        });
    },
    errTips: function () {
        wx.getSystemInfo({
            success: function (res) {
                if (res.platform === "ios") {
                    wx.showModal({
                        content: "蓝牙模块初始化失败，请检查系统蓝牙功能是否开启。\n开启后请扫码重新进入页面！",
                        showCancel: false,
                    });
                }
                else if (res.platform === "android") {
                    wx.showModal({
                        content: "蓝牙模块初始化失败，请检查系统蓝牙及定位功能是否开启。\n开启后请扫码重新进入页面！",
                        showCancel: false,
                    });
                }
            },
        });
    },
    postError: function () {
        var _this = this;
        var OldError = console.error;
        console.error = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            _this.setData({
                errorList: _this.data.errorList.concat([
                    {
                        type: args[0],
                        json: JSON.stringify(args[1]),
                        time: Date.now(),
                    },
                ]),
            });
            OldError.call.apply(OldError, [console].concat(args));
        };
    },
    timer: function () {
        var _this = this;
        this.timerId = setInterval(function () {
            _this.setData({
                count: _this.data.count + 1,
            });
        }, 1000);
    },
    onShow: function () {
        this.pageShowTime = Date.now();
        this.postError();
        this.timer();
        this.init();
    },
    onHide: function () {
        this.setData({
            list: [],
            errorList: [],
            count: 0,
        });
        clearInterval(this.timerId);
        this.timerId = null;
        this.pageShowTime = 0;
        this.startTime = 0;
        this.scanTime = 0;
        wx.stopBluetoothDevicesDiscovery();
        wx.closeBluetoothAdapter();
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBR0EsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFjLENBQUM7QUFFakMsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osSUFBSSxFQUFFLEVBQVc7UUFDakIsU0FBUyxFQUFFLEVBQVc7UUFDdEIsS0FBSyxFQUFFLENBQUM7S0FDVDtJQUNELE9BQU8sRUFBRSxJQUFXO0lBQ3BCLFlBQVksRUFBRSxDQUFDO0lBQ2YsU0FBUyxFQUFFLENBQUM7SUFDWixRQUFRLEVBQUUsQ0FBQztJQUlYLElBQUk7UUFBSixpQkFpQ0M7UUFoQ0MsRUFBRSxDQUFDLG9CQUFvQixDQUFDO1lBRXRCLElBQUksRUFBRSxTQUFTO1lBQ2YsT0FBTyxFQUFFLFVBQUMsR0FBRztnQkFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUM5QyxLQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDNUIsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsUUFBUTtvQkFDZixJQUFJLEVBQUUsU0FBUztvQkFDZixRQUFRLEVBQUUsSUFBSTtpQkFDZixDQUFDLENBQUM7Z0JBQ0gsS0FBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ25CLENBQUM7WUFDRCxJQUFJLEVBQUUsVUFBQyxHQUFHO2dCQUNSLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBQ2hELEtBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDZixLQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQWM5QixDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUNELFNBQVM7UUFBVCxpQkFtSkM7UUFqSkMsRUFBRSxDQUFDLDhCQUE4QixD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QUFFLENBQUM7SUFDZCxDQUFDO0lBdUJELE1BQU07UUFJSixJQUFJLENBQUMsT0FBTyxDQUFDO1lBQ1gsSUFBSSxFQUFFLEVBQUU7WUFDUixTQUFTLEVBQUUsRUFBRTtZQUNiLEtBQUssRUFBRSxDQUFDO1NBQ1QsQ0FBQyxDQUFDO1FBQ0gsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNwQixJQUFJLENBQUMsWUFBWSxHQUFHLENBQUMsQ0FBQztRQUN0QixJQUFJLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztRQU9sQixFQUFFLENBQUMsNkJBQTZCLEVBQUUsQ0FBQztRQUNuQyxFQUFFLENBQUMscUJBQXFCLEVBQUUsQ0FBQztJQUM3QixDQUFDO0NBeUJGLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIGluZGV4LnRzXG4vLyDojrflj5blupTnlKjlrp7kvotcbi8vIEB0cy1pZ25vcmVcbmNvbnN0IGFwcCA9IGdldEFwcDxJQXBwT3B0aW9uPigpO1xuXG5QYWdlKHtcbiAgZGF0YToge1xuICAgIGxpc3Q6IFtdIGFzIGFueVtdLFxuICAgIGVycm9yTGlzdDogW10gYXMgYW55W10sXG4gICAgY291bnQ6IDAsXG4gIH0sXG4gIHRpbWVySWQ6IG51bGwgYXMgYW55LFxuICBwYWdlU2hvd1RpbWU6IDAsXG4gIHN0YXJ0VGltZTogMCxcbiAgc2NhblRpbWU6IDAsXG4gIC8vIHN0YXRlQ2hhbmdlQXZhVG9nOiBmYWxzZSxcbiAgLy8gc3RhdGVDaGFuZ2VOb3RBdmFUb2c6IGZhbHNlLFxuICAvLyDkuovku7blpITnkIblh73mlbBcbiAgaW5pdCgpIHtcbiAgICB3eC5vcGVuQmx1ZXRvb3RoQWRhcHRlcih7XG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBtb2RlOiBcImNlbnRyYWxcIixcbiAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJvcGVuQmx1ZXRvb3RoQWRhcHRlciBzdWNjXCIsIHJlcyk7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgICAgICAgICB0aXRsZTogXCLok53niZnlkK/liqjmiJDlip9cIixcbiAgICAgICAgICBpY29uOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgICBkdXJhdGlvbjogNTAwMCxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3RhcnRTY2FuKCk7XG4gICAgICB9LFxuICAgICAgZmFpbDogKHJlcykgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwib3BlbkJsdWV0b290aEFkYXB0ZXIgZmFpbFwiLCByZXMpO1xuICAgICAgICB0aGlzLmVyclRpcHMoKTtcbiAgICAgICAgdGhpcy5zdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuXG4gICAgICAgIC8vIGlmIChyZXMuZXJyQ29kZSAhPT0gMTAwMDEpIHJldHVybjtcblxuICAgICAgICAvLyB3eC5vbkJsdWV0b290aEFkYXB0ZXJTdGF0ZUNoYW5nZSgocmVzKSA9PiB7XG4gICAgICAgIC8vICAgY29uc29sZS5sb2coXCJhZGFwdGVyU3RhdGUgY2hhbmdlZCwgbm93IGlzXCIsIHJlcyk7XG4gICAgICAgIC8vICAgaWYgKHJlcy5hdmFpbGFibGUgJiYgIXRoaXMuc3RhdGVDaGFuZ2VBdmFUb2cpIHtcbiAgICAgICAgLy8gICAgIHRoaXMuc3RhcnRTY2FuKCk7XG4gICAgICAgIC8vICAgICB0aGlzLnN0YXRlQ2hhbmdlQXZhVG9nID0gdHJ1ZTtcbiAgICAgICAgLy8gICB9IGVsc2UgaWYgKCFyZXMuYXZhaWxhYmxlICYmICF0aGlzLnN0YXRlQ2hhbmdlTm90QXZhVG9nKSB7XG4gICAgICAgIC8vICAgICB0aGlzLmVyclRpcHMoKTtcbiAgICAgICAgLy8gICAgIHRoaXMuc3RhdGVDaGFuZ2VOb3RBdmFUb2cgPSB0cnVlO1xuICAgICAgICAvLyAgIH1cbiAgICAgICAgLy8gfSk7XG4gICAgICB9LFxuICAgIH0pO1xuICB9LFxuICBzdGFydFNjYW4oKSB7XG4gICAgLy8g5pCc57Si5aSW5Zu06JOd54mZ6K6+5aSHXG4gICAgd3guc3RhcnRCbHVldG9vdGhEZXZpY2VzRGlzY292ZXJ5KHtcbiAgICAgIGFsbG93RHVwbGljYXRlc0tleTogdHJ1ZSxcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHBvd2VyTGV2ZWw6IFwiaGlnaFwiLFxuICAgICAgc3VjY2VzczogKGUpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJzdGFydEJsdWV0b290aERldmljZXNEaXNjb3Zlcnkgc3VjY1wiLCBlKTtcbiAgICAgICAgdGhpcy5zY2FuVGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHd4Lm9uQmx1ZXRvb3RoRGV2aWNlRm91bmQoKHJlcykgPT4ge1xuICAgICAgICAgIHJlcy5kZXZpY2VzLmZvckVhY2goKGRldmljZSkgPT4ge1xuICAgICAgICAgICAgLy8g6L+Z6YeM5Y+v5Lul5YGa5LiA5Lqb6L+H5rukXG4gICAgICAgICAgICBpZiAoZGV2aWNlLm5hbWUuaW5kZXhPZihcIndlaXhpYW9cIikgPiAtMSkge1xuICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgVWludDhBcnJheShkZXZpY2UuYWR2ZXJ0aXNEYXRhKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhcnI6IGFueVtdID0gW107XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICBhcnIucHVzaCh2aWV3W2ldLnRvU3RyaW5nKDE2KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgICAgICAgXCJvbkJsdWV0b290aERldmljZUZvdW5kIGZvdW5kIVwiLFxuICAgICAgICAgICAgICAgICAgZGV2aWNlLFxuICAgICAgICAgICAgICAgICAgZGV2aWNlLm5hbWUsXG4gICAgICAgICAgICAgICAgICBhcnJcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRhdGEubGlzdC5sZW5ndGgpIHJldHVybjtcbiAgICAgICAgICAgICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG9wZW5JbnRlcnZhbCA9IG5vdyAtIHRoaXMucGFnZVNob3dUaW1lO1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0SW50ZXJ2YWwgPSBub3cgLSB0aGlzLnN0YXJ0VGltZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzY2FuSW50ZXJ2YWwgPSBub3cgLSB0aGlzLnNjYW5UaW1lO1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0RGF0YShcbiAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdDogW1xuICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGRldmljZS5sb2NhbE5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBhcnI6IGFyci5qb2luKFwiLVwiKS50b1VwcGVyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICAgICAgUlNTSTogYCR7ZGV2aWNlLlJTU0l9ZEJtYCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wZW5JbnRlcnZhbDogYCR7b3BlbkludGVydmFsIC8gMTAwMH1zYCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0SW50ZXJ2YWw6IGAke3N0YXJ0SW50ZXJ2YWwgLyAxMDAwfXNgLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbkludGVydmFsOiBgJHtzY2FuSW50ZXJ2YWwgLyAxMDAwfXNgLFxuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAvLyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAvLyAgIC8qKlxuICAgICAgICAgICAgICAgICAgLy8gICAgKiB0eXBlOiBCTEVcbiAgICAgICAgICAgICAgICAgIC8vICAgICog5pe26Ze05oizXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIOiTneeJmeWQjeensFxuICAgICAgICAgICAgICAgICAgLy8gICAgKiDpqozor4HnoIFcbiAgICAgICAgICAgICAgICAgIC8vICAgICog5L+h5Y+35by65bqmXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIOmhtemdouaXtumXtOW3rlxuICAgICAgICAgICAgICAgICAgLy8gICAgKiDlkK/liqjml7bpl7Tlt65cbiAgICAgICAgICAgICAgICAgIC8vICAgICog5pCc57Si5pe26Ze05beuXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIOiuvuWkh+S/oeaBryBKU09OLnN0cmluZyh3eC5nZXRTeXN0ZW1JbmZvU3luYygpKVxuICAgICAgICAgICAgICAgICAgLy8gICAgKiBhcHAuZ2xvYmFsRGF0YS51dWlkXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIGFwcC5nbG9iYWxEYXRhLnVzZXJuYW1lXG4gICAgICAgICAgICAgICAgICAvLyAgICAqL1xuICAgICAgICAgICAgICAgICAgLy8gICBpZiAoYXBwLmdsb2JhbERhdGEudXNlck5hbWUpIHtcbiAgICAgICAgICAgICAgICAgIC8vICAgICB0aGlzLnJlcXVlc3REYXRhKHtcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHR5cGU6IFwiQkxFXCIsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICB0aW1lOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgbmFtZTogZGV2aWNlLmxvY2FsTmFtZSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIGNvZGU6IGFyci5qb2luKFwiLVwiKS50b1VwcGVyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgUlNTSTogZGV2aWNlLlJTU0ksXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICBvcGVuSW50ZXJ2YWwsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICBzdGFydEludGVydmFsLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgc2NhbkludGVydmFsLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgZGV2aWNlSW5mbzogd3guZ2V0U3lzdGVtSW5mb1N5bmMoKSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHV1aWQ6IGFwcC5nbG9iYWxEYXRhLnV1aWQsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICB1c2VySW5mbzogYXBwLmdsb2JhbERhdGEudXNlckluZm8sXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICB1c2VyTmFtZTogYXBwLmdsb2JhbERhdGEudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAvLyAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5zZXROYW1lTW9kYWwoKS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHRoaXMucmVxdWVzdERhdGEoe1xuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB0eXBlOiBcIkJMRVwiLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB0aW1lOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBuYW1lOiBkZXZpY2UubG9jYWxOYW1lLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBjb2RlOiBhcnIuam9pbihcIi1cIikudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgUlNTSTogZGV2aWNlLlJTU0ksXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICAgIG9wZW5JbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgc3RhcnRJbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgc2NhbkludGVydmFsLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBkZXZpY2VJbmZvOiB3eC5nZXRTeXN0ZW1JbmZvU3luYygpLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB1dWlkOiBhcHAuZ2xvYmFsRGF0YS51dWlkLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB1c2VySW5mbzogYXBwLmdsb2JhbERhdGEudXNlckluZm8sXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHVzZXJOYW1lOiBhcHAuZ2xvYmFsRGF0YS51c2VyTmFtZSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAgICAgICAgICAgLy8gICB9XG4gICAgICAgICAgICAgICAgICAvLyB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJwYXJzZSBhZHZlcnRpc0RhdGEgZXJyb3JcIiwgZSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgLy8g5om+5Yiw6KaB5pCc57Si55qE6K6+5aSH5ZCO77yM5Y+K5pe25YGc5q2i5omr5o+PXG4gICAgICAgICAgICAgIHd4LnN0b3BCbHVldG9vdGhEZXZpY2VzRGlzY292ZXJ5KHtcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiAoZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdG9wQmx1ZXRvb3RoRGV2aWNlc0Rpc2NvdmVyeSBzdWNjXCIsIGUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZmFpbDogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJzdG9wQmx1ZXRvb3RoRGV2aWNlc0Rpc2NvdmVyeSBmYWlsXCIsIGUpO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgICBmYWlsOiAoZTogYW55KSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJzdGFydEJsdWV0b290aERldmljZXNEaXNjb3ZlcnkgZmFpbFwiLCBlKTtcbiAgICAgICAgLy8gdGhpcy5zdGF0ZUNoYW5nZUF2YVRvZyA9IGZhbHNlO1xuICAgICAgICAvLyB0aGlzLnN0YXRlQ2hhbmdlTm90QXZhVG9nID0gZmFsc2U7XG5cbiAgICAgICAgd3guZ2V0U3lzdGVtSW5mbyh7XG4gICAgICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAgICAgICAgICAgaWYgKGUuZXJyQ29kZSA9PT0gMTAwMDEgJiYgZS5lcnJubyA9PT0gMTUwMDEwMikge1xuICAgICAgICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6XG4gICAgICAgICAgICAgICAgICBcIuiTneeJmeaQnOe0ouW5v+aSreWksei0pe+8jOivt+ajgOafpeezu+e7n+iTneeJmeWKn+iDveaYr+WQpuW8gOWQr+OAglxcbuW8gOWQr+WQjuivt+aJq+eggemHjeaWsOi/m+WFpemhtemdou+8gVwiLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWw6IGZhbHNlLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgICAgICAgIHJlcy5wbGF0Zm9ybSA9PT0gXCJhbmRyb2lkXCIgJiZcbiAgICAgICAgICAgICAgZS5lcnJDb2RlID09PSAtMSAmJlxuICAgICAgICAgICAgICBlLmVycm5vID09PSAxNTA5MDA5XG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgICAgICAgXCLok53niZnmkJzntKLlub/mkq3lpLHotKXvvIzor7fmo4Dmn6Xns7vnu5/lrprkvY3lip/og73mmK/lkKblvIDlkK/jgIJcXG7lvIDlkK/lkI7or7fmiavnoIHph43mlrDov5vlhaXpobXpnaLvvIFcIixcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsOiBmYWxzZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICByZXMucGxhdGZvcm0gPT09IFwiYW5kcm9pZFwiICYmXG4gICAgICAgICAgICAgIGUuZXJyQ29kZSA9PT0gLTEgJiZcbiAgICAgICAgICAgICAgZS5lcnJubyA9PT0gMTUwOTAwOFxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICAgICAgY29udGVudDpcbiAgICAgICAgICAgICAgICAgIFwi6JOd54mZ5pCc57Si5bm/5pKt5aSx6LSl77yM6K+35qOA5p+l5piv5ZCm5Li65b6u5L+h5o6I5p2D5a6a5L2N5Yqf6IO944CCXFxu5byA5ZCv5ZCO6K+35omr56CB6YeN5paw6L+b5YWl6aG16Z2i77yBXCIsXG4gICAgICAgICAgICAgICAgc2hvd0NhbmNlbDogZmFsc2UsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgZXJyVGlwcygpIHtcbiAgICB3eC5nZXRTeXN0ZW1JbmZvKHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgaWYgKHJlcy5wbGF0Zm9ybSA9PT0gXCJpb3NcIikge1xuICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgICBcIuiTneeJmeaooeWdl+WIneWni+WMluWksei0pe+8jOivt+ajgOafpeezu+e7n+iTneeJmeWKn+iDveaYr+WQpuW8gOWQr+OAglxcbuW8gOWQr+WQjuivt+aJq+eggemHjeaWsOi/m+WFpemhtemdou+8gVwiLFxuICAgICAgICAgICAgc2hvd0NhbmNlbDogZmFsc2UsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzLnBsYXRmb3JtID09PSBcImFuZHJvaWRcIikge1xuICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgICBcIuiTneeJmeaooeWdl+WIneWni+WMluWksei0pe+8jOivt+ajgOafpeezu+e7n+iTneeJmeWPiuWumuS9jeWKn+iDveaYr+WQpuW8gOWQr+OAglxcbuW8gOWQr+WQjuivt+aJq+eggemHjeaWsOi/m+WFpemhtemdou+8gVwiLFxuICAgICAgICAgICAgc2hvd0NhbmNlbDogZmFsc2UsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIHBvc3RFcnJvcigpIHtcbiAgICBjb25zdCBPbGRFcnJvciA9IGNvbnNvbGUuZXJyb3I7XG4gICAgY29uc29sZS5lcnJvciA9ICguLi5hcmdzKSA9PiB7XG4gICAgICB0aGlzLnNldERhdGEoXG4gICAgICAgIHtcbiAgICAgICAgICBlcnJvckxpc3Q6IHRoaXMuZGF0YS5lcnJvckxpc3QuY29uY2F0KFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdHlwZTogYXJnc1swXSxcbiAgICAgICAgICAgICAganNvbjogSlNPTi5zdHJpbmdpZnkoYXJnc1sxXSksXG4gICAgICAgICAgICAgIHRpbWU6IERhdGUubm93KCksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0pLFxuICAgICAgICB9XG4gICAgICAgIC8vICgpID0+IHtcbiAgICAgICAgLy8gICAvKipcbiAgICAgICAgLy8gICAgKiB0eXBlOiBCTEVcbiAgICAgICAgLy8gICAgKiB1dWlkXG4gICAgICAgIC8vICAgICog6ZSZ6K+v57G75Z6LXG4gICAgICAgIC8vICAgICog5L+h5oGvXG4gICAgICAgIC8vICAgICog5pe26Ze05oizXG4gICAgICAgIC8vICAgICog6K6+5aSH5L+h5oGvIEpTT04uc3RyaW5nKHd4LmdldFN5c3RlbUluZm9TeW5jKCkpXG4gICAgICAgIC8vICAgICogYXBwLmdsb2JhbERhdGEudXVpZFxuICAgICAgICAvLyAgICAqIGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvXG4gICAgICAgIC8vICAgICogYXBwLmdsb2JhbERhdGEudXNlcm5hbWVcbiAgICAgICAgLy8gICAgKi9cbiAgICAgICAgLy8gICBpZiAoYXBwLmdsb2JhbERhdGEudXNlck5hbWUpIHtcbiAgICAgICAgLy8gICAgIHRoaXMucmVxdWVzdEVycm9yKHtcbiAgICAgICAgLy8gICAgICAgdHlwZTogXCJCTEVcIixcbiAgICAgICAgLy8gICAgICAgdGltZTogRGF0ZS5ub3coKSxcbiAgICAgICAgLy8gICAgICAgZXJyVHlwZTogYXJnc1swXSxcbiAgICAgICAgLy8gICAgICAganNvbjogYXJnc1sxXSxcbiAgICAgICAgLy8gICAgICAgZGV2aWNlSW5mbzogd3guZ2V0U3lzdGVtSW5mb1N5bmMoKSxcbiAgICAgICAgLy8gICAgICAgdXVpZDogYXBwLmdsb2JhbERhdGEudXVpZCxcbiAgICAgICAgLy8gICAgICAgdXNlckluZm86IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLFxuICAgICAgICAvLyAgICAgICB1c2VyTmFtZTogYXBwLmdsb2JhbERhdGEudXNlck5hbWUsXG4gICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgLy8gICB9IGVsc2Uge1xuICAgICAgICAvLyAgICAgdGhpcy5zZXROYW1lTW9kYWwoKS50aGVuKCgpID0+IHtcbiAgICAgICAgLy8gICAgICAgdGhpcy5yZXF1ZXN0RXJyb3Ioe1xuICAgICAgICAvLyAgICAgICAgIHR5cGU6IFwiQkxFXCIsXG4gICAgICAgIC8vICAgICAgICAgdGltZTogRGF0ZS5ub3coKSxcbiAgICAgICAgLy8gICAgICAgICBlcnJUeXBlOiBhcmdzWzBdLFxuICAgICAgICAvLyAgICAgICAgIGpzb246IGFyZ3NbMV0sXG4gICAgICAgIC8vICAgICAgICAgZGV2aWNlSW5mbzogd3guZ2V0U3lzdGVtSW5mb1N5bmMoKSxcbiAgICAgICAgLy8gICAgICAgICB1dWlkOiBhcHAuZ2xvYmFsRGF0YS51dWlkLFxuICAgICAgICAvLyAgICAgICAgIHVzZXJJbmZvOiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mbyxcbiAgICAgICAgLy8gICAgICAgICB1c2VyTmFtZTogYXBwLmdsb2JhbERhdGEudXNlck5hbWUsXG4gICAgICAgIC8vICAgICAgIH0pO1xuICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgIC8vICAgfVxuICAgICAgICAvLyB9XG4gICAgICApO1xuXG4gICAgICBPbGRFcnJvci5jYWxsKGNvbnNvbGUsIC4uLmFyZ3MpO1xuICAgIH07XG4gIH0sXG4gIC8vIHJlcXVlc3REYXRhKGRhdGE6IGFueSkge1xuICAvLyAgIHd4LnNob3dMb2FkaW5nKHtcbiAgLy8gICAgIHRpdGxlOiBcIuS4iuS8oOWunumqjOe7k+aenOS4rVwiLFxuICAvLyAgICAgbWFzazogdHJ1ZSxcbiAgLy8gICB9KTtcbiAgLy8gICB3eC5yZXF1ZXN0KHtcbiAgLy8gICAgIHVybDogXCJodHRwczovL3R5Zy53ZWl4aWFvLnFxLmNvbS9mci9ibHVldG9vdGgvbG9nXCIsXG4gIC8vICAgICBkYXRhLFxuICAvLyAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgLy8gICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgLy8gICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlID09PSAyMDAgJiYgKHJlcy5kYXRhIGFzIGFueSkuY29kZSA9PT0gMCkge1xuICAvLyAgICAgICAgIHd4LmhpZGVMb2FkaW5nKCk7XG4gIC8vICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgLy8gICAgICAgICAgIHRpdGxlOiBcIuWunumqjOS4iuaKpeaIkOWKn1wiLFxuICAvLyAgICAgICAgICAgaWNvbjogXCJzdWNjZXNzXCIsXG4gIC8vICAgICAgICAgICBkdXJhdGlvbjogNTAwMCxcbiAgLy8gICAgICAgICB9KTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSxcbiAgLy8gICAgIGZhaWw6IChyZXMpID0+IHtcbiAgLy8gICAgICAgY29uc29sZS53YXJuKHJlcyk7XG4gIC8vICAgICAgIHd4LmhpZGVMb2FkaW5nKCk7XG4gIC8vICAgICAgIHd4LnNob3dUb2FzdCh7XG4gIC8vICAgICAgICAgdGl0bGU6IFwi5a6e6aqM5LiK5oql5aSx6LSlXCIsXG4gIC8vICAgICAgICAgaWNvbjogXCJzdWNjZXNzXCIsXG4gIC8vICAgICAgICAgZHVyYXRpb246IDUwMDAsXG4gIC8vICAgICAgIH0pO1xuICAvLyAgICAgfSxcbiAgLy8gICB9KTtcbiAgLy8gfSxcbiAgLy8gcmVxdWVzdEVycm9yKGRhdGE6IGFueSkge1xuICAvLyAgIHd4LnNob3dMb2FkaW5nKHtcbiAgLy8gICAgIHRpdGxlOiBcIumUmeivr+S/oeaBr+S4iuaKpeS4rVwiLFxuICAvLyAgICAgbWFzazogdHJ1ZSxcbiAgLy8gICB9KTtcbiAgLy8gICB3eC5yZXF1ZXN0KHtcbiAgLy8gICAgIHVybDogXCJodHRwczovL3R5Zy53ZWl4aWFvLnFxLmNvbS9mci9ibHVldG9vdGgvbG9nXCIsXG4gIC8vICAgICBkYXRhLFxuICAvLyAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgLy8gICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgLy8gICAgICAgaWYgKHJlcy5zdGF0dXNDb2RlID09PSAyMDAgJiYgKHJlcy5kYXRhIGFzIGFueSkuY29kZSA9PT0gMCkge1xuICAvLyAgICAgICAgIHd4LmhpZGVMb2FkaW5nKCk7XG4gIC8vICAgICAgICAgd3guc2hvd1RvYXN0KHtcbiAgLy8gICAgICAgICAgIHRpdGxlOiBcIumUmeivr+S4iuaKpeaIkOWKn1wiLFxuICAvLyAgICAgICAgICAgaWNvbjogXCJub25lXCIsXG4gIC8vICAgICAgICAgICBkdXJhdGlvbjogNTAwMCxcbiAgLy8gICAgICAgICB9KTtcbiAgLy8gICAgICAgfVxuICAvLyAgICAgfSxcbiAgLy8gICAgIGZhaWw6IChyZXMpID0+IHtcbiAgLy8gICAgICAgY29uc29sZS53YXJuKHJlcyk7XG4gIC8vICAgICAgIHd4LmhpZGVMb2FkaW5nKCk7XG4gIC8vICAgICAgIHd4LnNob3dUb2FzdCh7XG4gIC8vICAgICAgICAgdGl0bGU6IFwi6ZSZ6K+v5LiK5oql5aSx6LSlXCIsXG4gIC8vICAgICAgICAgaWNvbjogXCJub25lXCIsXG4gIC8vICAgICAgICAgZHVyYXRpb246IDUwMDAsXG4gIC8vICAgICAgIH0pO1xuICAvLyAgICAgfSxcbiAgLy8gICB9KTtcbiAgLy8gfSxcbiAgdGltZXIoKSB7XG4gICAgdGhpcy50aW1lcklkID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgdGhpcy5zZXREYXRhKHtcbiAgICAgICAgY291bnQ6IHRoaXMuZGF0YS5jb3VudCArIDEsXG4gICAgICB9KTtcbiAgICB9LCAxMDAwKTtcbiAgfSxcbiAgb25TaG93KCkge1xuICAgIHRoaXMucGFnZVNob3dUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB0aGlzLnBvc3RFcnJvcigpO1xuICAgIHRoaXMudGltZXIoKTtcbiAgICB0aGlzLmluaXQoKTtcbiAgfSxcbiAgLy8gc2V0TmFtZU1vZGFsKCkge1xuICAvLyAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAvLyAgICAgcmV0dXJuIHd4LnNob3dNb2RhbCh7XG4gIC8vICAgICAgIHRpdGxlOiBcIuivt+i+k+WFpeaCqOeahOS8geW+ruWQje+8jOaWueS+v+aIkeS7rOWBmuWQjuacn+mXrumimOiwg+afpVwiLFxuICAvLyAgICAgICAvLyBAdHMtaWdub3JlXG4gIC8vICAgICAgIGVkaXRhYmxlOiB0cnVlLFxuICAvLyAgICAgICBzaG93Q2FuY2VsOiBmYWxzZSxcbiAgLy8gICAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAvLyAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgLy8gICAgICAgICBpZiAocmVzLmNvbnRlbnQpIHtcbiAgLy8gICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgLy8gICAgICAgICAgIGNvbnN0IHVzZXJOYW1lID0gd3guc2V0U3RvcmFnZVN5bmMoXCJ1c2VyTmFtZVwiLCByZXMuY29udGVudCk7XG4gIC8vICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gIC8vICAgICAgICAgICBhcHAuZ2xvYmFsRGF0YS51c2VyTmFtZSA9IHJlcy5jb250ZW50O1xuICAvLyAgICAgICAgIH0gZWxzZSB7XG4gIC8vICAgICAgICAgICBhcHAuZ2xvYmFsRGF0YS51c2VyTmFtZSA9IFwiXCI7XG4gIC8vICAgICAgICAgfVxuICAvLyAgICAgICAgIHJlc29sdmUoYXBwLmdsb2JhbERhdGEudXNlck5hbWUpO1xuICAvLyAgICAgICB9LFxuICAvLyAgICAgfSk7XG4gIC8vICAgfSk7XG4gIC8vIH0sXG4gIG9uSGlkZSgpIHtcbiAgICAvKipcbiAgICAgKiBjbGVhclxuICAgICAqL1xuICAgIHRoaXMuc2V0RGF0YSh7XG4gICAgICBsaXN0OiBbXSxcbiAgICAgIGVycm9yTGlzdDogW10sXG4gICAgICBjb3VudDogMCxcbiAgICB9KTtcbiAgICBjbGVhckludGVydmFsKHRoaXMudGltZXJJZCk7XG4gICAgdGhpcy50aW1lcklkID0gbnVsbDtcbiAgICB0aGlzLnBhZ2VTaG93VGltZSA9IDA7XG4gICAgdGhpcy5zdGFydFRpbWUgPSAwO1xuICAgIHRoaXMuc2NhblRpbWUgPSAwO1xuICAgIC8vIHRoaXMuc3RhdGVDaGFuZ2VBdmFUb2cgPSBmYWxzZTtcbiAgICAvLyB0aGlzLnN0YXRlQ2hhbmdlTm90QXZhVG9nID0gZmFsc2U7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIC8vIHd4Lm9mZkJsdWV0b290aEFkYXB0ZXJTdGF0ZUNoYW5nZSgpO1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICAvLyB3eC5vZmZCbHVldG9vdGhEZXZpY2VGb3VuZCgpO1xuICAgIHd4LnN0b3BCbHVldG9vdGhEZXZpY2VzRGlzY292ZXJ5KCk7XG4gICAgd3guY2xvc2VCbHVldG9vdGhBZGFwdGVyKCk7XG4gIH0sXG4gIC8vIHRvQmx1ZXRvb3RoU2V0dGluZygpIHtcbiAgLy8gICBjb25zb2xlLmxvZyhcImJlIGhlcmVcIik7XG4gIC8vICAgLy8gQHRzLWlnbm9yZVxuICAvLyAgIHd4Lm9wZW5TeXN0ZW1CbHVldG9vdGhTZXR0aW5nKHtcbiAgLy8gICAgIHN1Y2Nlc3MocmVzOiBhbnkpIHtcbiAgLy8gICAgICAgY29uc29sZS5sb2cocmVzKTtcbiAgLy8gICAgIH0sXG4gIC8vICAgICBmYWlsKGU6IGFueSkge1xuICAvLyAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAvLyAgICAgfSxcbiAgLy8gICB9KTtcbiAgLy8gfSxcbiAgLy8gdG9BcHBBdXRob3JpemVTZXR0aW5nKCkge1xuICAvLyAgIGNvbnNvbGUubG9nKFwiYmUgaGVyZVwiKTtcbiAgLy8gICAvLyBAdHMtaWdub3JlXG4gIC8vICAgd3gub3BlbkFwcEF1dGhvcml6ZVNldHRpbmcoe1xuICAvLyAgICAgc3VjY2VzcyhyZXM6IGFueSkge1xuICAvLyAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAvLyAgICAgfSxcbiAgLy8gICAgIGZhaWwoZTogYW55KSB7XG4gIC8vICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gIC8vICAgICB9LFxuICAvLyAgIH0pO1xuICAvLyB9LFxufSk7XG4iXX0=