"use strict";
var app = getApp();
Page({
    data: {
        list: [],
        errorList: [],
        count: 0,
    },
    timerId: null,
    pageShowTime: 0,
    startTime: 0,
    scanTime: 0,
    init: function () {
        var _this = this;
        wx.openBluetoothAdapter({
            mode: "central",
            success: function (res) {
                console.log("openBluetoothAdapter succ", res);
                _this.startTime = Date.now();
                wx.showToast({
                    title: "蓝牙启动成功",
                    icon: "success",
                    duration: 5000,
                });
                _this.startScan();
            },
            fail: function (res) {
                console.error("openBluetoothAdapter fail", res);
                _this.startTime = Date.now();
            },
        });
    },
    startScan: function () {
        var _this = this;
        wx.startBluetoothDevicesDiscovery({
            allowDuplicatesKey: true,
            powerLevel: "high",
            success: function (e) {
                console.log("startBluetoothDevicesDiscovery succ", e);
                _this.scanTime = Date.now();
                wx.onBluetoothDeviceFound(function (res) {
                    res.devices.forEach(function (device) {
                        if (device.name.indexOf("weixiao") > -1) {
                            try {
                                var view = new Uint8Array(device.advertisData);
                                var arr = [];
                                for (var i = 0; i < view.length; i++) {
                                    arr.push(view[i].toString(16));
                                }
                                console.log("onBluetoothDeviceFound found!", device, device.name, arr);
                                if (_this.data.list.length)
                                    return;
                                var now = Date.now();
                                var openInterval = now - _this.pageShowTime;
                                var startInterval = now - _this.startTime;
                                var scanInterval = now - _this.scanTime;
                                _this.setData({
                                    list: [
                                        {
                                            name: device.localName,
                                            arr: arr.join("-").toUpperCase(),
                                            RSSI: device.RSSI + "dBm",
                                            openInterval: openInterval / 1000 + "s",
                                            startInterval: startInterval / 1000 + "s",
                                            scanInterval: scanInterval / 1000 + "s",
                                        },
                                    ],
                                });
                            }
                            catch (e) {
                                console.error("parse advertisData error", e);
                            }
                            wx.stopBluetoothDevicesDiscovery({
                                success: function (e) {
                                    console.log("stopBluetoothDevicesDiscovery succ", e);
                                },
                                fail: function (e) {
                                    console.error("stopBluetoothDevicesDiscovery fail", e);
                                },
                            });
                        }
                    });
                });
            },
            fail: function (e) {
                console.error("startBluetoothDevicesDiscovery fail", e);
                wx.getSystemInfo({
                    success: function (res) {
                        if (e.errCode === 10001 && e.errno === 1500102) {
                            wx.showModal({
                                content: "蓝牙搜索广播失败，请检查系统蓝牙功能是否开启。\n开启后请扫码重新进入页面！",
                                showCancel: false,
                            });
                        }
                        else if (res.platform === "android" &&
                            e.errCode === -1 &&
                            e.errno === 1509009) {
                            wx.showModal({
                                content: "蓝牙搜索广播失败，请检查系统定位功能是否开启。\n开启后请扫码重新进入页面！",
                                showCancel: false,
                            });
                        }
                        else if (res.platform === "android" &&
                            e.errCode === -1 &&
                            e.errno === 1509008) {
                            wx.showModal({
                                content: "蓝牙搜索广播失败，请检查是否为微信授权定位功能。\n开启后请扫码重新进入页面！",
                                showCancel: false,
                            });
                        }
                    },
                });
            },
        });
    },
    onShow: function () {
        this.pageShowTime = Date.now();
        this.init();
    },
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBR0EsSUFBTSxHQUFHLEdBQUcsTUFBTSxFQUFjLENBQUM7QUFFakMsSUFBSSxDQUFDO0lBQ0gsSUFBSSxFQUFFO1FBQ0osSUFBSSxFQUFFLEVBQVc7UUFDakIsU0FBUyxFQUFFLEVBQVc7UUFDdEIsS0FBSyxFQUFFLENBQUM7S0FDVDtJQUNELE9BQU8sRUFBRSxJQUFXO0lBQ3BCLFlBQVksRUFBRSxDQUFDO0lBQ2YsU0FBUyxFQUFFLENBQUM7SUFDWixRQUFRLEVBQUUsQ0FBQztJQUlYLElBQUk7UUFBSixpQkFpQ0M7UUFoQ0MsRUFBRSxDQUFDLG9CQUFvQixDQUFDO1lBRXRCLElBQUksRUFBRSxTQUFTO1lBQ2YsT0FBTyxFQUFFLFVBQUMsR0FBRztnQkFDWCxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUM5QyxLQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDNUIsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsUUFBUTtvQkFDZixJQUFJLEVBQUUsU0FBUztvQkFDZixRQUFRLEVBQUUsSUFBSTtpQkFDZixDQUFDLENBQUM7Z0JBQ0gsS0FBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQ25CLENBQUM7WUFDRCxJQUFJLEVBQUUsVUFBQyxHQUFHO2dCQUNSLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxDQUFDLENBQUM7Z0JBRWhELEtBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBYzlCLENBQUM7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBQ0QsU0FBUztRQUFULGlCQW1KQztRQWpKQyxFQUFFLENBQUMsOEJBQThCLENBQUM7WUFDaEMsa0JBQWtCLEVBQUUsSUFBSTtZQUV4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S0FBSyxLQUFLLE9BQU8sRUFBRTs0QkFDOUMsRUFBRSxDQUFDLFNBQVMsQ0FBQztnQ0FDWCxPQUFPLEVBQ0wsd0NBQXdDO2dDQUMxQyxVQUFVLEVBQUUsS0FBSzs2QkFDbEIsQ0FBQyxDQUFDO3lCQUNKOzZCQUFNLElBQ0wsR0FBRyxDQUFDLFFBQVEsS0FBSyxTQUFTOzRCQUMxQixDQUFDLENBQUMsT0FBTyxLQUFLLENBQUMsQ0FBQzs0QkFDaEIsQ0FBQyxDQUFDLEtBQUssS0FBSyxPQUFPLEVBQ25COzRCQUNBLEVBQUUsQ0FBQyxTQUFTLENBQUM7Z0NBQ1gsT0FBTyxFQUNMLHdDQUF3QztnQ0FDMUMsVUFBVSxFQUFFLEtBQUs7NkJBQ2xCLENBQUMsQ0FBQzt5QkFDSjs2QkFBTSxJQUNMLEdBQUcsQ0FBQyxRQUFRLEtBQUssU0FBUzs0QkFDMUIsQ0FBQyxDQUFDLE9BQU8sS0FBSyxDQUFDLENBQUM7NEJBQ2hCLENBQUMsQ0FBQyxLQUFLLEtBQUssT0FBTyxFQUNuQjs0QkFDQSxFQUFFLENBQUMsU0FBUyxDQUFDO2dDQUNYLE9BQU8sRUFDTCx5Q0FBeUM7Z0NBQzNDLFVBQVUsRUFBRSxLQUFLOzZCQUNsQixDQUFDLENBQUM7eUJBQ0o7b0JBQ0gsQ0FBQztpQkFDRixDQUFDLENBQUM7WUFDTCxDQUFDO1NBQ0YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQWdKRCxNQUFNO1FBQ0osSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFHL0IsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ2QsQ0FBQztDQXNFRixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBpbmRleC50c1xuLy8g6I635Y+W5bqU55So5a6e5L6LXG4vLyBAdHMtaWdub3JlXG5jb25zdCBhcHAgPSBnZXRBcHA8SUFwcE9wdGlvbj4oKTtcblxuUGFnZSh7XG4gIGRhdGE6IHtcbiAgICBsaXN0OiBbXSBhcyBhbnlbXSxcbiAgICBlcnJvckxpc3Q6IFtdIGFzIGFueVtdLFxuICAgIGNvdW50OiAwLFxuICB9LFxuICB0aW1lcklkOiBudWxsIGFzIGFueSxcbiAgcGFnZVNob3dUaW1lOiAwLFxuICBzdGFydFRpbWU6IDAsXG4gIHNjYW5UaW1lOiAwLFxuICAvLyBzdGF0ZUNoYW5nZUF2YVRvZzogZmFsc2UsXG4gIC8vIHN0YXRlQ2hhbmdlTm90QXZhVG9nOiBmYWxzZSxcbiAgLy8g5LqL5Lu25aSE55CG5Ye95pWwXG4gIGluaXQoKSB7XG4gICAgd3gub3BlbkJsdWV0b290aEFkYXB0ZXIoe1xuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgbW9kZTogXCJjZW50cmFsXCIsXG4gICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwib3BlbkJsdWV0b290aEFkYXB0ZXIgc3VjY1wiLCByZXMpO1xuICAgICAgICB0aGlzLnN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHd4LnNob3dUb2FzdCh7XG4gICAgICAgICAgdGl0bGU6IFwi6JOd54mZ5ZCv5Yqo5oiQ5YqfXCIsXG4gICAgICAgICAgaWNvbjogXCJzdWNjZXNzXCIsXG4gICAgICAgICAgZHVyYXRpb246IDUwMDAsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN0YXJ0U2NhbigpO1xuICAgICAgfSxcbiAgICAgIGZhaWw6IChyZXMpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIm9wZW5CbHVldG9vdGhBZGFwdGVyIGZhaWxcIiwgcmVzKTtcbiAgICAgICAgLy8gdGhpcy5lcnJUaXBzKCk7XG4gICAgICAgIHRoaXMuc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcblxuICAgICAgICAvLyBpZiAocmVzLmVyckNvZGUgIT09IDEwMDAxKSByZXR1cm47XG5cbiAgICAgICAgLy8gd3gub25CbHVldG9vdGhBZGFwdGVyU3RhdGVDaGFuZ2UoKHJlcykgPT4ge1xuICAgICAgICAvLyAgIGNvbnNvbGUubG9nKFwiYWRhcHRlclN0YXRlIGNoYW5nZWQsIG5vdyBpc1wiLCByZXMpO1xuICAgICAgICAvLyAgIGlmIChyZXMuYXZhaWxhYmxlICYmICF0aGlzLnN0YXRlQ2hhbmdlQXZhVG9nKSB7XG4gICAgICAgIC8vICAgICB0aGlzLnN0YXJ0U2NhbigpO1xuICAgICAgICAvLyAgICAgdGhpcy5zdGF0ZUNoYW5nZUF2YVRvZyA9IHRydWU7XG4gICAgICAgIC8vICAgfSBlbHNlIGlmICghcmVzLmF2YWlsYWJsZSAmJiAhdGhpcy5zdGF0ZUNoYW5nZU5vdEF2YVRvZykge1xuICAgICAgICAvLyAgICAgdGhpcy5lcnJUaXBzKCk7XG4gICAgICAgIC8vICAgICB0aGlzLnN0YXRlQ2hhbmdlTm90QXZhVG9nID0gdHJ1ZTtcbiAgICAgICAgLy8gICB9XG4gICAgICAgIC8vIH0pO1xuICAgICAgfSxcbiAgICB9KTtcbiAgfSxcbiAgc3RhcnRTY2FuKCkge1xuICAgIC8vIOaQnOe0ouWkluWbtOiTneeJmeiuvuWkh1xuICAgIHd4LnN0YXJ0Qmx1ZXRvb3RoRGV2aWNlc0Rpc2NvdmVyeSh7XG4gICAgICBhbGxvd0R1cGxpY2F0ZXNLZXk6IHRydWUsXG4gICAgICAvLyBAdHMtaWdub3JlXG4gICAgICBwb3dlckxldmVsOiBcImhpZ2hcIixcbiAgICAgIHN1Y2Nlc3M6IChlKSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3RhcnRCbHVldG9vdGhEZXZpY2VzRGlzY292ZXJ5IHN1Y2NcIiwgZSk7XG4gICAgICAgIHRoaXMuc2NhblRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICB3eC5vbkJsdWV0b290aERldmljZUZvdW5kKChyZXMpID0+IHtcbiAgICAgICAgICByZXMuZGV2aWNlcy5mb3JFYWNoKChkZXZpY2UpID0+IHtcbiAgICAgICAgICAgIC8vIOi/memHjOWPr+S7peWBmuS4gOS6m+i/h+a7pFxuICAgICAgICAgICAgaWYgKGRldmljZS5uYW1lLmluZGV4T2YoXCJ3ZWl4aWFvXCIpID4gLTEpIHtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB2aWV3ID0gbmV3IFVpbnQ4QXJyYXkoZGV2aWNlLmFkdmVydGlzRGF0YSk7XG4gICAgICAgICAgICAgICAgY29uc3QgYXJyOiBhbnlbXSA9IFtdO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgYXJyLnB1c2godmlld1tpXS50b1N0cmluZygxNikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgICAgIFwib25CbHVldG9vdGhEZXZpY2VGb3VuZCBmb3VuZCFcIixcbiAgICAgICAgICAgICAgICAgIGRldmljZSxcbiAgICAgICAgICAgICAgICAgIGRldmljZS5uYW1lLFxuICAgICAgICAgICAgICAgICAgYXJyXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5kYXRhLmxpc3QubGVuZ3RoKSByZXR1cm47XG4gICAgICAgICAgICAgICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvcGVuSW50ZXJ2YWwgPSBub3cgLSB0aGlzLnBhZ2VTaG93VGltZTtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGFydEludGVydmFsID0gbm93IC0gdGhpcy5zdGFydFRpbWU7XG4gICAgICAgICAgICAgICAgY29uc3Qgc2NhbkludGVydmFsID0gbm93IC0gdGhpcy5zY2FuVGltZTtcbiAgICAgICAgICAgICAgICB0aGlzLnNldERhdGEoXG4gICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxpc3Q6IFtcbiAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBkZXZpY2UubG9jYWxOYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXJyOiBhcnIuam9pbihcIi1cIikudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFJTU0k6IGAke2RldmljZS5SU1NJfWRCbWAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvcGVuSW50ZXJ2YWw6IGAke29wZW5JbnRlcnZhbCAvIDEwMDB9c2AsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydEludGVydmFsOiBgJHtzdGFydEludGVydmFsIC8gMTAwMH1zYCxcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjYW5JbnRlcnZhbDogYCR7c2NhbkludGVydmFsIC8gMTAwMH1zYCxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgLy8gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgLy8gICAvKipcbiAgICAgICAgICAgICAgICAgIC8vICAgICogdHlwZTogQkxFXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIOaXtumXtOaIs1xuICAgICAgICAgICAgICAgICAgLy8gICAgKiDok53niZnlkI3np7BcbiAgICAgICAgICAgICAgICAgIC8vICAgICog6aqM6K+B56CBXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIOS/oeWPt+W8uuW6plxuICAgICAgICAgICAgICAgICAgLy8gICAgKiDpobXpnaLml7bpl7Tlt65cbiAgICAgICAgICAgICAgICAgIC8vICAgICog5ZCv5Yqo5pe26Ze05beuXG4gICAgICAgICAgICAgICAgICAvLyAgICAqIOaQnOe0ouaXtumXtOW3rlxuICAgICAgICAgICAgICAgICAgLy8gICAgKiDorr7lpIfkv6Hmga8gSlNPTi5zdHJpbmcod3guZ2V0U3lzdGVtSW5mb1N5bmMoKSlcbiAgICAgICAgICAgICAgICAgIC8vICAgICogYXBwLmdsb2JhbERhdGEudXVpZFxuICAgICAgICAgICAgICAgICAgLy8gICAgKiBhcHAuZ2xvYmFsRGF0YS51c2VySW5mb1xuICAgICAgICAgICAgICAgICAgLy8gICAgKiBhcHAuZ2xvYmFsRGF0YS51c2VybmFtZVxuICAgICAgICAgICAgICAgICAgLy8gICAgKi9cbiAgICAgICAgICAgICAgICAgIC8vICAgaWYgKGFwcC5nbG9iYWxEYXRhLnVzZXJOYW1lKSB7XG4gICAgICAgICAgICAgICAgICAvLyAgICAgdGhpcy5yZXF1ZXN0RGF0YSh7XG4gICAgICAgICAgICAgICAgICAvLyAgICAgICB0eXBlOiBcIkJMRVwiLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgdGltZTogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIG5hbWU6IGRldmljZS5sb2NhbE5hbWUsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICBjb2RlOiBhcnIuam9pbihcIi1cIikudG9VcHBlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIFJTU0k6IGRldmljZS5SU1NJLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgb3BlbkludGVydmFsLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgc3RhcnRJbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIHNjYW5JbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgIGRldmljZUluZm86IHd4LmdldFN5c3RlbUluZm9TeW5jKCksXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICB1dWlkOiBhcHAuZ2xvYmFsRGF0YS51dWlkLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgdXNlckluZm86IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgdXNlck5hbWU6IGFwcC5nbG9iYWxEYXRhLnVzZXJOYW1lLFxuICAgICAgICAgICAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAgICAgICAgICAgLy8gICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuc2V0TmFtZU1vZGFsKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAvLyAgICAgICB0aGlzLnJlcXVlc3REYXRhKHtcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgdHlwZTogXCJCTEVcIixcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgdGltZTogRGF0ZS5ub3coKSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgbmFtZTogZGV2aWNlLmxvY2FsTmFtZSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgY29kZTogYXJyLmpvaW4oXCItXCIpLnRvVXBwZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICAgIFJTU0k6IGRldmljZS5SU1NJLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICBvcGVuSW50ZXJ2YWwsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHN0YXJ0SW50ZXJ2YWwsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICAgIHNjYW5JbnRlcnZhbCxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgZGV2aWNlSW5mbzogd3guZ2V0U3lzdGVtSW5mb1N5bmMoKSxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgdXVpZDogYXBwLmdsb2JhbERhdGEudXVpZCxcbiAgICAgICAgICAgICAgICAgIC8vICAgICAgICAgdXNlckluZm86IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLFxuICAgICAgICAgICAgICAgICAgLy8gICAgICAgICB1c2VyTmFtZTogYXBwLmdsb2JhbERhdGEudXNlck5hbWUsXG4gICAgICAgICAgICAgICAgICAvLyAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIC8vICAgfVxuICAgICAgICAgICAgICAgICAgLy8gfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwicGFyc2UgYWR2ZXJ0aXNEYXRhIGVycm9yXCIsIGUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIC8vIOaJvuWIsOimgeaQnOe0oueahOiuvuWkh+WQju+8jOWPiuaXtuWBnOatouaJq+aPj1xuICAgICAgICAgICAgICB3eC5zdG9wQmx1ZXRvb3RoRGV2aWNlc0Rpc2NvdmVyeSh7XG4gICAgICAgICAgICAgICAgc3VjY2VzczogKGUpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3RvcEJsdWV0b290aERldmljZXNEaXNjb3Zlcnkgc3VjY1wiLCBlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGZhaWw6IChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwic3RvcEJsdWV0b290aERldmljZXNEaXNjb3ZlcnkgZmFpbFwiLCBlKTtcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9LFxuICAgICAgZmFpbDogKGU6IGFueSkgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwic3RhcnRCbHVldG9vdGhEZXZpY2VzRGlzY292ZXJ5IGZhaWxcIiwgZSk7XG4gICAgICAgIC8vIHRoaXMuc3RhdGVDaGFuZ2VBdmFUb2cgPSBmYWxzZTtcbiAgICAgICAgLy8gdGhpcy5zdGF0ZUNoYW5nZU5vdEF2YVRvZyA9IGZhbHNlO1xuXG4gICAgICAgIHd4LmdldFN5c3RlbUluZm8oe1xuICAgICAgICAgIHN1Y2Nlc3M6IChyZXMpID0+IHtcbiAgICAgICAgICAgIGlmIChlLmVyckNvZGUgPT09IDEwMDAxICYmIGUuZXJybm8gPT09IDE1MDAxMDIpIHtcbiAgICAgICAgICAgICAgd3guc2hvd01vZGFsKHtcbiAgICAgICAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgICAgICAgXCLok53niZnmkJzntKLlub/mkq3lpLHotKXvvIzor7fmo4Dmn6Xns7vnu5/ok53niZnlip/og73mmK/lkKblvIDlkK/jgIJcXG7lvIDlkK/lkI7or7fmiavnoIHph43mlrDov5vlhaXpobXpnaLvvIFcIixcbiAgICAgICAgICAgICAgICBzaG93Q2FuY2VsOiBmYWxzZSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgICAgICByZXMucGxhdGZvcm0gPT09IFwiYW5kcm9pZFwiICYmXG4gICAgICAgICAgICAgIGUuZXJyQ29kZSA9PT0gLTEgJiZcbiAgICAgICAgICAgICAgZS5lcnJubyA9PT0gMTUwOTAwOVxuICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgIHd4LnNob3dNb2RhbCh7XG4gICAgICAgICAgICAgICAgY29udGVudDpcbiAgICAgICAgICAgICAgICAgIFwi6JOd54mZ5pCc57Si5bm/5pKt5aSx6LSl77yM6K+35qOA5p+l57O757uf5a6a5L2N5Yqf6IO95piv5ZCm5byA5ZCv44CCXFxu5byA5ZCv5ZCO6K+35omr56CB6YeN5paw6L+b5YWl6aG16Z2i77yBXCIsXG4gICAgICAgICAgICAgICAgc2hvd0NhbmNlbDogZmFsc2UsXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICAgICAgcmVzLnBsYXRmb3JtID09PSBcImFuZHJvaWRcIiAmJlxuICAgICAgICAgICAgICBlLmVyckNvZGUgPT09IC0xICYmXG4gICAgICAgICAgICAgIGUuZXJybm8gPT09IDE1MDkwMDhcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAgICAgICAgICAgICAgIGNvbnRlbnQ6XG4gICAgICAgICAgICAgICAgICBcIuiTneeJmeaQnOe0ouW5v+aSreWksei0pe+8jOivt+ajgOafpeaYr+WQpuS4uuW+ruS/oeaOiOadg+WumuS9jeWKn+iDveOAglxcbuW8gOWQr+WQjuivt+aJq+eggemHjeaWsOi/m+WFpemhtemdou+8gVwiLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWw6IGZhbHNlLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0sXG4gIC8vIGVyclRpcHMoKSB7XG4gIC8vICAgd3guZ2V0U3lzdGVtSW5mbyh7XG4gIC8vICAgICAvLyBAdHMtaWdub3JlXG4gIC8vICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gIC8vICAgICAgIGlmIChyZXMucGxhdGZvcm0gPT09IFwiaW9zXCIpIHtcbiAgLy8gICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAvLyAgICAgICAgICAgY29udGVudDpcbiAgLy8gICAgICAgICAgICAgXCLok53niZnmqKHlnZfliJ3lp4vljJblpLHotKXvvIzor7fmo4Dmn6Xns7vnu5/ok53niZnlip/og73mmK/lkKblvIDlkK/jgIJcXG7lvIDlkK/lkI7or7fmiavnoIHph43mlrDov5vlhaXpobXpnaLvvIFcIixcbiAgLy8gICAgICAgICAgIHNob3dDYW5jZWw6IGZhbHNlLFxuICAvLyAgICAgICAgIH0pO1xuICAvLyAgICAgICB9IGVsc2UgaWYgKHJlcy5wbGF0Zm9ybSA9PT0gXCJhbmRyb2lkXCIpIHtcbiAgLy8gICAgICAgICB3eC5zaG93TW9kYWwoe1xuICAvLyAgICAgICAgICAgY29udGVudDpcbiAgLy8gICAgICAgICAgICAgXCLok53niZnmqKHlnZfliJ3lp4vljJblpLHotKXvvIzor7fmo4Dmn6Xns7vnu5/ok53niZnlj4rlrprkvY3lip/og73mmK/lkKblvIDlkK/jgIJcXG7lvIDlkK/lkI7or7fmiavnoIHph43mlrDov5vlhaXpobXpnaLvvIFcIixcbiAgLy8gICAgICAgICAgIHNob3dDYW5jZWw6IGZhbHNlLFxuICAvLyAgICAgICAgIH0pO1xuICAvLyAgICAgICB9XG4gIC8vICAgICB9LFxuICAvLyAgIH0pO1xuICAvLyB9LFxuICAvLyBwb3N0RXJyb3IoKSB7XG4gIC8vICAgY29uc3QgT2xkRXJyb3IgPSBjb25zb2xlLmVycm9yO1xuICAvLyAgIGNvbnNvbGUuZXJyb3IgPSAoLi4uYXJncykgPT4ge1xuICAvLyAgICAgdGhpcy5zZXREYXRhKFxuICAvLyAgICAgICB7XG4gIC8vICAgICAgICAgZXJyb3JMaXN0OiB0aGlzLmRhdGEuZXJyb3JMaXN0LmNvbmNhdChbXG4gIC8vICAgICAgICAgICB7XG4gIC8vICAgICAgICAgICAgIHR5cGU6IGFyZ3NbMF0sXG4gIC8vICAgICAgICAgICAgIGpzb246IEpTT04uc3RyaW5naWZ5KGFyZ3NbMV0pLFxuICAvLyAgICAgICAgICAgICB0aW1lOiBEYXRlLm5vdygpLFxuICAvLyAgICAgICAgICAgfSxcbiAgLy8gICAgICAgICBdKSxcbiAgLy8gICAgICAgfSxcbiAgLy8gICAgICAgKCkgPT4ge1xuICAvLyAgICAgICAgIC8qKlxuICAvLyAgICAgICAgICAqIHR5cGU6IEJMRVxuICAvLyAgICAgICAgICAqIHV1aWRcbiAgLy8gICAgICAgICAgKiDplJnor6/nsbvlnotcbiAgLy8gICAgICAgICAgKiDkv6Hmga9cbiAgLy8gICAgICAgICAgKiDml7bpl7TmiLNcbiAgLy8gICAgICAgICAgKiDorr7lpIfkv6Hmga8gSlNPTi5zdHJpbmcod3guZ2V0U3lzdGVtSW5mb1N5bmMoKSlcbiAgLy8gICAgICAgICAgKiBhcHAuZ2xvYmFsRGF0YS51dWlkXG4gIC8vICAgICAgICAgICogYXBwLmdsb2JhbERhdGEudXNlckluZm9cbiAgLy8gICAgICAgICAgKiBhcHAuZ2xvYmFsRGF0YS51c2VybmFtZVxuICAvLyAgICAgICAgICAqL1xuICAvLyAgICAgICAgIC8vIGlmIChhcHAuZ2xvYmFsRGF0YS51c2VyTmFtZSkge1xuICAvLyAgICAgICAgIC8vICAgdGhpcy5yZXF1ZXN0RXJyb3Ioe1xuICAvLyAgICAgICAgIC8vICAgICB0eXBlOiBcIkJMRVwiLFxuICAvLyAgICAgICAgIC8vICAgICB0aW1lOiBEYXRlLm5vdygpLFxuICAvLyAgICAgICAgIC8vICAgICBlcnJUeXBlOiBhcmdzWzBdLFxuICAvLyAgICAgICAgIC8vICAgICBqc29uOiBhcmdzWzFdLFxuICAvLyAgICAgICAgIC8vICAgICBkZXZpY2VJbmZvOiB3eC5nZXRTeXN0ZW1JbmZvU3luYygpLFxuICAvLyAgICAgICAgIC8vICAgICB1dWlkOiBhcHAuZ2xvYmFsRGF0YS51dWlkLFxuICAvLyAgICAgICAgIC8vICAgICB1c2VySW5mbzogYXBwLmdsb2JhbERhdGEudXNlckluZm8sXG4gIC8vICAgICAgICAgLy8gICAgIHVzZXJOYW1lOiBhcHAuZ2xvYmFsRGF0YS51c2VyTmFtZSxcbiAgLy8gICAgICAgICAvLyAgIH0pO1xuICAvLyAgICAgICAgIC8vIH0gZWxzZSB7XG4gIC8vICAgICAgICAgLy8gICB0aGlzLnNldE5hbWVNb2RhbCgpLnRoZW4oKCkgPT4ge1xuICAvLyAgICAgICAgIC8vICAgICB0aGlzLnJlcXVlc3RFcnJvcih7XG4gIC8vICAgICAgICAgLy8gICAgICAgdHlwZTogXCJCTEVcIixcbiAgLy8gICAgICAgICAvLyAgICAgICB0aW1lOiBEYXRlLm5vdygpLFxuICAvLyAgICAgICAgIC8vICAgICAgIGVyclR5cGU6IGFyZ3NbMF0sXG4gIC8vICAgICAgICAgLy8gICAgICAganNvbjogYXJnc1sxXSxcbiAgLy8gICAgICAgICAvLyAgICAgICBkZXZpY2VJbmZvOiB3eC5nZXRTeXN0ZW1JbmZvU3luYygpLFxuICAvLyAgICAgICAgIC8vICAgICAgIHV1aWQ6IGFwcC5nbG9iYWxEYXRhLnV1aWQsXG4gIC8vICAgICAgICAgLy8gICAgICAgdXNlckluZm86IGFwcC5nbG9iYWxEYXRhLnVzZXJJbmZvLFxuICAvLyAgICAgICAgIC8vICAgICAgIHVzZXJOYW1lOiBhcHAuZ2xvYmFsRGF0YS51c2VyTmFtZSxcbiAgLy8gICAgICAgICAvLyAgICAgfSk7XG4gIC8vICAgICAgICAgLy8gICB9KTtcbiAgLy8gICAgICAgICAvLyB9XG4gIC8vICAgICAgIH1cbiAgLy8gICAgICk7XG5cbiAgLy8gICAgIE9sZEVycm9yLmNhbGwoY29uc29sZSwgLi4uYXJncyk7XG4gIC8vICAgfTtcbiAgLy8gfSxcbiAgLy8gLy8gcmVxdWVzdERhdGEoZGF0YTogYW55KSB7XG4gIC8vIC8vICAgd3guc2hvd0xvYWRpbmcoe1xuICAvLyAvLyAgICAgdGl0bGU6IFwi5LiK5Lyg5a6e6aqM57uT5p6c5LitXCIsXG4gIC8vIC8vICAgICBtYXNrOiB0cnVlLFxuICAvLyAvLyAgIH0pO1xuICAvLyAvLyAgIHd4LnJlcXVlc3Qoe1xuICAvLyAvLyAgICAgdXJsOiBcImh0dHBzOi8vdHlnLndlaXhpYW8ucXEuY29tL2ZyL2JsdWV0b290aC9sb2dcIixcbiAgLy8gLy8gICAgIGRhdGEsXG4gIC8vIC8vICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAvLyAvLyAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAvLyAvLyAgICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPT09IDIwMCAmJiAocmVzLmRhdGEgYXMgYW55KS5jb2RlID09PSAwKSB7XG4gIC8vIC8vICAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgLy8gLy8gICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAvLyAvLyAgICAgICAgICAgdGl0bGU6IFwi5a6e6aqM5LiK5oql5oiQ5YqfXCIsXG4gIC8vIC8vICAgICAgICAgICBpY29uOiBcInN1Y2Nlc3NcIixcbiAgLy8gLy8gICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLFxuICAvLyAvLyAgICAgICAgIH0pO1xuICAvLyAvLyAgICAgICB9XG4gIC8vIC8vICAgICB9LFxuICAvLyAvLyAgICAgZmFpbDogKHJlcykgPT4ge1xuICAvLyAvLyAgICAgICBjb25zb2xlLndhcm4ocmVzKTtcbiAgLy8gLy8gICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgLy8gLy8gICAgICAgd3guc2hvd1RvYXN0KHtcbiAgLy8gLy8gICAgICAgICB0aXRsZTogXCLlrp7pqozkuIrmiqXlpLHotKVcIixcbiAgLy8gLy8gICAgICAgICBpY29uOiBcInN1Y2Nlc3NcIixcbiAgLy8gLy8gICAgICAgICBkdXJhdGlvbjogNTAwMCxcbiAgLy8gLy8gICAgICAgfSk7XG4gIC8vIC8vICAgICB9LFxuICAvLyAvLyAgIH0pO1xuICAvLyAvLyB9LFxuICAvLyAvLyByZXF1ZXN0RXJyb3IoZGF0YTogYW55KSB7XG4gIC8vIC8vICAgd3guc2hvd0xvYWRpbmcoe1xuICAvLyAvLyAgICAgdGl0bGU6IFwi6ZSZ6K+v5L+h5oGv5LiK5oql5LitXCIsXG4gIC8vIC8vICAgICBtYXNrOiB0cnVlLFxuICAvLyAvLyAgIH0pO1xuICAvLyAvLyAgIHd4LnJlcXVlc3Qoe1xuICAvLyAvLyAgICAgdXJsOiBcImh0dHBzOi8vdHlnLndlaXhpYW8ucXEuY29tL2ZyL2JsdWV0b290aC9sb2dcIixcbiAgLy8gLy8gICAgIGRhdGEsXG4gIC8vIC8vICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAvLyAvLyAgICAgc3VjY2VzczogKHJlcykgPT4ge1xuICAvLyAvLyAgICAgICBpZiAocmVzLnN0YXR1c0NvZGUgPT09IDIwMCAmJiAocmVzLmRhdGEgYXMgYW55KS5jb2RlID09PSAwKSB7XG4gIC8vIC8vICAgICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgLy8gLy8gICAgICAgICB3eC5zaG93VG9hc3Qoe1xuICAvLyAvLyAgICAgICAgICAgdGl0bGU6IFwi6ZSZ6K+v5LiK5oql5oiQ5YqfXCIsXG4gIC8vIC8vICAgICAgICAgICBpY29uOiBcIm5vbmVcIixcbiAgLy8gLy8gICAgICAgICAgIGR1cmF0aW9uOiA1MDAwLFxuICAvLyAvLyAgICAgICAgIH0pO1xuICAvLyAvLyAgICAgICB9XG4gIC8vIC8vICAgICB9LFxuICAvLyAvLyAgICAgZmFpbDogKHJlcykgPT4ge1xuICAvLyAvLyAgICAgICBjb25zb2xlLndhcm4ocmVzKTtcbiAgLy8gLy8gICAgICAgd3guaGlkZUxvYWRpbmcoKTtcbiAgLy8gLy8gICAgICAgd3guc2hvd1RvYXN0KHtcbiAgLy8gLy8gICAgICAgICB0aXRsZTogXCLplJnor6/kuIrmiqXlpLHotKVcIixcbiAgLy8gLy8gICAgICAgICBpY29uOiBcIm5vbmVcIixcbiAgLy8gLy8gICAgICAgICBkdXJhdGlvbjogNTAwMCxcbiAgLy8gLy8gICAgICAgfSk7XG4gIC8vIC8vICAgICB9LFxuICAvLyAvLyAgIH0pO1xuICAvLyAvLyB9LFxuICAvLyB0aW1lcigpIHtcbiAgLy8gICB0aGlzLnRpbWVySWQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gIC8vICAgICB0aGlzLnNldERhdGEoe1xuICAvLyAgICAgICBjb3VudDogdGhpcy5kYXRhLmNvdW50ICsgMSxcbiAgLy8gICAgIH0pO1xuICAvLyAgIH0sIDEwMDApO1xuICAvLyB9LFxuICBvblNob3coKSB7XG4gICAgdGhpcy5wYWdlU2hvd1RpbWUgPSBEYXRlLm5vdygpO1xuICAgIC8vIHRoaXMucG9zdEVycm9yKCk7XG4gICAgLy8gdGhpcy50aW1lcigpO1xuICAgIHRoaXMuaW5pdCgpO1xuICB9LFxuICAvLyBzZXROYW1lTW9kYWwoKSB7XG4gIC8vICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gIC8vICAgICByZXR1cm4gd3guc2hvd01vZGFsKHtcbiAgLy8gICAgICAgdGl0bGU6IFwi6K+36L6T5YWl5oKo55qE5LyB5b6u5ZCN77yM5pa55L6/5oiR5Lus5YGa5ZCO5pyf6Zeu6aKY6LCD5p+lXCIsXG4gIC8vICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgLy8gICAgICAgZWRpdGFibGU6IHRydWUsXG4gIC8vICAgICAgIHNob3dDYW5jZWw6IGZhbHNlLFxuICAvLyAgICAgICBzdWNjZXNzOiAocmVzKSA9PiB7XG4gIC8vICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAvLyAgICAgICAgIGlmIChyZXMuY29udGVudCkge1xuICAvLyAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAvLyAgICAgICAgICAgY29uc3QgdXNlck5hbWUgPSB3eC5zZXRTdG9yYWdlU3luYyhcInVzZXJOYW1lXCIsIHJlcy5jb250ZW50KTtcbiAgLy8gICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgLy8gICAgICAgICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJOYW1lID0gcmVzLmNvbnRlbnQ7XG4gIC8vICAgICAgICAgfSBlbHNlIHtcbiAgLy8gICAgICAgICAgIGFwcC5nbG9iYWxEYXRhLnVzZXJOYW1lID0gXCJcIjtcbiAgLy8gICAgICAgICB9XG4gIC8vICAgICAgICAgcmVzb2x2ZShhcHAuZ2xvYmFsRGF0YS51c2VyTmFtZSk7XG4gIC8vICAgICAgIH0sXG4gIC8vICAgICB9KTtcbiAgLy8gICB9KTtcbiAgLy8gfSxcbiAgLy8gb25IaWRlKCkge1xuICAvLyAgIC8qKlxuICAvLyAgICAqIGNsZWFyXG4gIC8vICAgICovXG4gIC8vICAgdGhpcy5zZXREYXRhKHtcbiAgLy8gICAgIGxpc3Q6IFtdLFxuICAvLyAgICAgZXJyb3JMaXN0OiBbXSxcbiAgLy8gICAgIGNvdW50OiAwLFxuICAvLyAgIH0pO1xuICAvLyAgIGNsZWFySW50ZXJ2YWwodGhpcy50aW1lcklkKTtcbiAgLy8gICB0aGlzLnRpbWVySWQgPSBudWxsO1xuICAvLyAgIHRoaXMucGFnZVNob3dUaW1lID0gMDtcbiAgLy8gICB0aGlzLnN0YXJ0VGltZSA9IDA7XG4gIC8vICAgdGhpcy5zY2FuVGltZSA9IDA7XG4gIC8vICAgLy8gdGhpcy5zdGF0ZUNoYW5nZUF2YVRvZyA9IGZhbHNlO1xuICAvLyAgIC8vIHRoaXMuc3RhdGVDaGFuZ2VOb3RBdmFUb2cgPSBmYWxzZTtcbiAgLy8gICAvLyBAdHMtaWdub3JlXG4gIC8vICAgLy8gd3gub2ZmQmx1ZXRvb3RoQWRhcHRlclN0YXRlQ2hhbmdlKCk7XG4gIC8vICAgLy8gQHRzLWlnbm9yZVxuICAvLyAgIC8vIHd4Lm9mZkJsdWV0b290aERldmljZUZvdW5kKCk7XG4gIC8vICAgd3guc3RvcEJsdWV0b290aERldmljZXNEaXNjb3ZlcnkoKTtcbiAgLy8gICB3eC5jbG9zZUJsdWV0b290aEFkYXB0ZXIoKTtcbiAgLy8gfSxcbiAgLy8gLy8gdG9CbHVldG9vdGhTZXR0aW5nKCkge1xuICAvLyAvLyAgIGNvbnNvbGUubG9nKFwiYmUgaGVyZVwiKTtcbiAgLy8gLy8gICAvLyBAdHMtaWdub3JlXG4gIC8vIC8vICAgd3gub3BlblN5c3RlbUJsdWV0b290aFNldHRpbmcoe1xuICAvLyAvLyAgICAgc3VjY2VzcyhyZXM6IGFueSkge1xuICAvLyAvLyAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xuICAvLyAvLyAgICAgfSxcbiAgLy8gLy8gICAgIGZhaWwoZTogYW55KSB7XG4gIC8vIC8vICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gIC8vIC8vICAgICB9LFxuICAvLyAvLyAgIH0pO1xuICAvLyAvLyB9LFxuICAvLyAvLyB0b0FwcEF1dGhvcml6ZVNldHRpbmcoKSB7XG4gIC8vIC8vICAgY29uc29sZS5sb2coXCJiZSBoZXJlXCIpO1xuICAvLyAvLyAgIC8vIEB0cy1pZ25vcmVcbiAgLy8gLy8gICB3eC5vcGVuQXBwQXV0aG9yaXplU2V0dGluZyh7XG4gIC8vIC8vICAgICBzdWNjZXNzKHJlczogYW55KSB7XG4gIC8vIC8vICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XG4gIC8vIC8vICAgICB9LFxuICAvLyAvLyAgICAgZmFpbChlOiBhbnkpIHtcbiAgLy8gLy8gICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgLy8gLy8gICAgIH0sXG4gIC8vIC8vICAgfSk7XG4gIC8vIC8vIH0sXG59KTtcbiJdfQ==